(function(e){var t;define([],function(){return function(){describe("Node preprocessing",function(){beforeEach(jasmine.prepareTestNode),beforeEach(function(){this.restoreAfter(ko.bindingProvider,"instance");var e=function(){};e.prototype=ko.bindingProvider.instance,ko.bindingProvider.instance=new e}),it("Can leave the nodes unchanged by returning a falsey value",function(){ko.bindingProvider.instance.preprocessNode=function(e){return null},testNode.innerHTML="<p data-bind='text: someValue'></p>",ko.applyBindings({someValue:"hello"},testNode),expect(testNode).toContainText("hello")}),it("Can replace a node with some other node",function(){ko.bindingProvider.instance.preprocessNode=function(e){if(e.tagName&&e.tagName.toLowerCase()==="myspecialnode"){var t=document.createElement("span");return t.setAttribute("data-bind","text: someValue"),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),[t]}},testNode.innerHTML="<span>a</span><mySpecialNode></mySpecialNode><span>b</span>";var e=ko.observable("hello");ko.applyBindings({someValue:e},testNode),expect(testNode).toContainText("ahellob"),e("goodbye"),expect(testNode).toContainText("agoodbyeb")}),it("Can replace a node with multiple new nodes",function(){ko.bindingProvider.instance.preprocessNode=function(e){if(e.nodeType===3&&e.data.indexOf("{{ someValue }}")>=0){var t=e.data.substring(0,e.data.indexOf("{{ someValue }}")),n=e.data.substring(e.data.indexOf("{{ someValue }}")+"{{ someValue }}".length),r=[document.createTextNode(t),document.createComment("ko text: someValue"),document.createComment("/ko"),document.createTextNode(n)];for(var i=0;i<r.length;i++)e.parentNode.insertBefore(r[i],e);return e.parentNode.removeChild(e),r}},testNode.innerHTML="the value is {{ someValue }}.";var e=ko.observable("hello");ko.applyBindings({someValue:e},testNode),expect(testNode).toContainText("the value is hello."),e("goodbye"),expect(testNode).toContainText("the value is goodbye.")}),it("Can modify the set of top-level nodes in a foreach loop",function(){ko.bindingProvider.instance.preprocessNode=function(e){if(e.tagName&&e.tagName.toLowerCase()==="data"){var t=document.createElement("span");return t.setAttribute("data-bind","text: $data"),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),[t]}if(e.tagName&&e.tagName.toLowerCase()==="button")return e.parentNode.removeChild(e),[]},testNode.innerHTML="<div data-bind='foreach: items'><button>DeleteMe</button><data></data><!-- ko text: $data --><!-- /ko --><button>DeleteMe</button></div>";var e=ko.observableArray(["Alpha","Beta"]);ko.applyBindings({items:e},testNode),expect(testNode).toContainText("AlphaAlphaBetaBeta"),e.splice(0,1),expect(testNode).toContainText("BetaBeta"),e.push("Gamma"),expect(testNode).toContainText("BetaBetaGammaGamma")})})}.call(e),t})})(this);