(function(e){var t;define([],function(){return function(){describe("Components: Default loader",function(){function t(t,n){ko.components.unregister(e),ko.components.register(e,t);var r=!1;ko.components.get(e,function(e){n(e),r=!0}),waitsFor(function(){return r},1e3)}function n(e,n,r){var i=document.createElement("div");document.body.appendChild(i),i.innerHTML="ignored"+e.replace("{0}","<p>Some text</p><div>More stuff</div>");var s=i.childNodes[1],o=n||s;t({template:{element:o}},function(e){expect(e.template.length).toBe(2),expect(e.template[0].tagName).toBe("P"),expect(e.template[0]).toContainText("Some text"),expect(e.template[1].tagName).toBe("DIV"),expect(e.template[1]).toContainText("More stuff"),r&&r(s),i.parentNode&&i.parentNode.removeChild(i)})}function r(e,t){e.restoreAfter(window,"require"),window.require=function(e,n){expect(e.length).toBe(1);if(!(e[0]in t))throw new Error("Undefined module: "+e[0]);setTimeout(function(){n(t[e[0]])},20)}}var e="test-component";afterEach(function(){ko.components.unregister(e)}),it("Allows registration of arbitrary component config objects, reports that they are registered, and allows unregistration",function(){ko.components.register(e,{}),expect(ko.components.isRegistered(e)).toBe(!0),expect(ko.components.isRegistered("other-component")).toBe(!1),ko.components.unregister(e,{}),ko.components.unregister("nonexistent-component",{}),expect(ko.components.isRegistered(e)).toBe(!1)}),it("Throws if you try to register a component that is already registered",function(){ko.components.register(e,{}),expect(function(){ko.components.register(e,{})}).toThrow()}),it("Throws if you try to register a falsey value",function(){expect(function(){ko.components.register(e,null)}).toThrow(),expect(function(){ko.components.register(e,undefined)}).toThrow()}),it("getConfig supplies config objects from the in-memory registry",function(){var t={},n=!1;ko.components.register(e,t),ko.components.defaultLoader.getConfig(e,function(e){expect(e).toBe(t),n=!0}),waitsFor(function(){return n},100)}),it("getConfig supplies null for unknown components",function(){var t=!1;ko.components.defaultLoader.getConfig(e,function(e){expect(e).toBe(null),t=!0}),waitsFor(function(){return t},100)}),it("Can load a template and viewmodel simultaneously",function(){var e,n,r=function(){},i=[],s=!1,o={template:{require:"path/templateModule"},viewModel:{require:"path/viewModelModule"}};this.restoreAfter(window,"require"),window.require=function(t,r){expect(t.length).toBe(1);switch(t[0]){case"path/templateModule":e=r;break;case"path/viewModelModule":n=r;break;default:throw new Error("Unexpected requirement for module "+t[0])}},t(o,function(e){s=!0,expect(e.template).toBe(i),expect(e.createViewModel).toBe(r)}),expect(typeof e).toBe("function"),expect(typeof n).toBe("function"),n({createViewModel:r}),expect(s).toBe(!1),e(i),expect(s).toBe(!0)}),it("Can resolve templates and viewmodels recursively",function(){r(this,{componentmodule:{template:{require:"templatemodule"},viewModel:{require:"viewmodelmodule"}},templatemodule:"<div>Hello world</div>",viewmodelmodule:{viewModel:function(e){this.receivedValue=e.suppliedValue}}}),t({require:"componentmodule"},function(e){expect(e.template.length).toBe(1),expect(e.template[0]).toContainText("Hello world");var t=e.createViewModel({suppliedValue:12.3},null);expect(t.receivedValue).toBe(12.3)})}),it("Can be asked to resolve a template directly",function(){var e="<span>Markup string</span><div>More</div>",t=!1;ko.components.defaultLoader.loadTemplate("any-component",e,function(e){expect(e.length).toBe(2),expect(e[0].tagName).toBe("SPAN"),expect(e[1].tagName).toBe("DIV"),expect(e[0].innerHTML).toBe("Markup string"),expect(e[1].innerHTML).toBe("More"),t=!0}),expect(t).toBe(!0)}),it("Can be asked to resolve a viewmodel directly",function(){var e=function(e){this.suppliedParams=e},t=!1;ko.components.defaultLoader.loadViewModel("any-component",e,function(n){var r={},i=n(r,null);expect(i instanceof e).toBe(!0),expect(i.suppliedParams).toBe(r),t=!0}),expect(t).toBe(!0)}),it("Will load templates via 'loadTemplate' on any other registered loader that precedes it",function(){var n={loadTemplate:function(t,n,r){expect(t).toBe(e),expect(n.customThing).toBe(123),r(ko.utils.parseHtmlFragment("<div>Hello world</div>"))},loadViewModel:function(e,t,n){n(null)}};this.restoreAfter(ko.components,"loaders"),ko.components.loaders=[n,ko.components.defaultLoader];var r={template:{customThing:123},viewModel:{instance:{}}};t(r,function(e){expect(e.template.length).toBe(1),expect(e.template[0]).toContainText("Hello world");var t=e.createViewModel(null,null);expect(t).toBe(r.viewModel.instance)})}),it("Will load viewmodels via 'loadViewModel' on any other registered loader that precedes it",function(){var n={},r={},i={},s={loadTemplate:function(e,t,n){n(null)},loadViewModel:function(t,s,o){expect(t).toBe(e),expect(s.customThing).toBe(456),o(function(e,t){return expect(e).toBe(n),expect(t).toBe(r),i})}};this.restoreAfter(ko.components,"loaders"),ko.components.loaders=[s,ko.components.defaultLoader];var o={template:"<div>Hello world</div>",viewModel:{customThing:456}};t(o,function(e){expect(e.template.length).toBe(1),expect(e.template[0]).toContainText("Hello world");var t=e.createViewModel(n,r);expect(t).toBe(i)})}),describe("Configuration formats",function(){describe("Templates are normalised to arrays of DOM nodes",function(){it("Can be configured as a DOM node array",function(){var e=[document.createElement("div"),document.createElement("p")];t({template:e},function(t){expect(t.template).toBe(e)})}),it("Can be configured as a document fragment",function(){var e=document.createDocumentFragment(),n=document.createElement("div");e.appendChild(n),t({template:e},function(e){expect(e.template).toEqual([n])})}),it("Can be configured as a string of markup",function(){t({template:"<p>Some text</p><div>More stuff</div>"},function(e){expect(e.template.length).toBe(2),expect(e.template[0].tagName).toBe("P"),expect(e.template[0]).toContainText("Some text"),expect(e.template[1].tagName).toBe("DIV"),expect(e.template[1]).toContainText("More stuff")})}),it("Can be configured as an element ID",function(){n('<div id="my-container-elem">{0}</div>',"my-container-elem",function(e){expect(e.childNodes.length).toBe(2)})}),it("Can be configured as the ID of a <script> element",function(){n('<script id="my-script-elem" type="text/html">{0}</script>',"my-script-elem")}),it("Can be configured as the ID of a <textarea> element",function(){n('<textarea id="my-textarea-elem">{0}</textarea>',"my-textarea-elem")}),it("Can be configured as the ID of a <template> element",function(){document.createElement("template"),n('<template id="my-template-elem">{0}</template>',"my-template-elem")}),it("Can be configured as a regular element instance",function(){n("<div>{0}</div>",null,function(e){expect(e.childNodes.length).toBe(2)})}),it("Can be configured as a <script> element instance",function(){n('<script type="text/html">{0}</script>',null)}),it("Can be configured as a <textarea> element instance",function(){n("<textarea>{0}</textarea>",null)}),it("Can be configured as a <template> element instance",function(){document.createElement("template"),n("<template>{0}</template>",null)}),it("Can be configured as an AMD module whose value is a DOM node array",function(){var e=[document.createElement("div"),document.createElement("p")];r(this,{"some/module/path":e}),t({template:{require:"some/module/path"}},function(t){expect(t.template).toBe(e)})}),it("Can be configured as an AMD module whose value is a document fragment",function(){var e=document.createDocumentFragment(),n=document.createElement("div");e.appendChild(n),r(this,{"some/module/path":e}),t({template:{require:"some/module/path"}},function(e){expect(e.template).toEqual([n])})}),it("Can be configured as an AMD module whose value is markup",function(){r(this,{"some/module/path":"<div>Hello world</div><p>The end</p>"}),t({template:{require:"some/module/path"}},function(e){expect(e.template.length).toBe(2),expect(e.template[0].tagName).toBe("DIV"),expect(e.template[0]).toContainText("Hello world"),expect(e.template[1].tagName).toBe("P"),expect(e.template[1]).toContainText("The end")})})}),describe("Viewmodels",function(){it("Can be configured as a createViewModel function",function(){var e=function(){};t({viewModel:{createViewModel:e}},function(t){expect(t.createViewModel).toBe(e)})}),it("Can be configured as a constructor function",function(){var e=function(e){this.receivedValue=e.suppliedValue};t({viewModel:e},function(e){var t=e.createViewModel({suppliedValue:123},null);expect(t.receivedValue).toBe(123)})}),it("Can be configured as an object instance",function(){var e={};t({viewModel:{instance:e}},function(t){var n=t.createViewModel(null,null);expect(n).toBe(e)})}),it("Can be configured as an AMD module that supplies a createViewModel factory",function(){var e=function(){};r(this,{"some/module/path":{createViewModel:e}}),t({viewModel:{require:"some/module/path"}},function(t){expect(t.createViewModel).toBe(e)})}),it("Can be configured as an AMD module that is a constructor function",function(){var e=function(e){this.receivedValue=e.suppliedValue};r(this,{"some/module/path":e}),t({viewModel:{require:"some/module/path"}},function(e){var t=e.createViewModel({suppliedValue:234},null);expect(t.receivedValue).toBe(234)})}),it("Can be configured as an AMD module that supplies a viewmodel configuration",function(){var e=function(e){this.receivedValue=e.suppliedValue};r(this,{"some/module/path":{viewModel:e}}),t({viewModel:{require:"some/module/path"}},function(e){var t=e.createViewModel({suppliedValue:345},null);expect(t.receivedValue).toBe(345)})})}),describe("Combined viewmodel/templates",function(){it("Can be configured as an AMD module",function(){var e={template:[],viewModel:function(e){this.receivedValue=e.suppliedValue}};r(this,{"some/module/path":e}),t({require:"some/module/path"},function(t){expect(t.template).toBe(e.template);var n=t.createViewModel({suppliedValue:567},null);expect(n.receivedValue).toBe(567)})})})})})}.call(e),t})})(this);