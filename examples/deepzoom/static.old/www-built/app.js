define("app/main",["require"],function(e){function t(){if(location.hash=="#deb")debugger}function d(e){HIGH=1,LOW=0,INC=1,DEC=0;var t=this;return t.model=e,t.id=t.model.channelCount,t.minVal=ko.observable("10"),t.maxVal=ko.observable("75"),t.inverted=ko.observable(!1),t.values=ko.computed({read:function(){return[t.minVal(),t.maxVal()]},write:function(e){t.minVal(e[0]),t.maxVal(e[1])},owner:t}),t.calcValues=ko.computed(function(){return inv=t.inverted()?-1:1,[t.minVal()*inv,t.maxVal()*inv]},t),t.nudge=function(e,n){theEnds=[Number(t.minVal()),Number(t.maxVal())],theDirection=[-1,1],theEnds[e]+=theDirection[n],t.values(theEnds)},t.calcValues.subscribe(function(){g(t.model)}),t.test=function(e){return e<=t.maxVal()&&e>=t.minVal()?!0:!1},t}function v(){var e=this;e.inBrowser=!0,e.onServer=!inBrowser,e.channelCount=0,e.colorspaces_choices=["hex","hsv","lab","rgb","xyz"],e.colorspaces_choices.theSelected=ko.observable(),e.colorspaces_choices.theSelected.subscribe(function(){g(e)}),e.channels=[];while(e.channelCount<3)e.channels[e.channelCount++]=new d(e);return e.enabled=ko.observable(!1),e.enabled.subscribe(function(){e.enabled()?g(e):y(e)}),e.count=function(){inBrowser&&(c=$(".openseadragon-canvas canvas")[0],ctx=c.getContext("2d"),now=(new Date).getTime(),then=now,dt(),countContext(ctx),dt(),countContext2(ctx),dt(),countContext(ctx,!0),dt())},e.overlay=function(){addOverlay(15e3,15e3,2e3)},e}function g(e){y(e,!0)}function y(e,t){s&&clearTimeout(s);if(t&&e.enabled()){s=setTimeout(function(){y(e)},1500);return}a=e.channels[0].calcValues(),b=e.channels[1].calcValues(),c=e.channels[2].calcValues(),m=e.colorspaces_choices.theSelected(),h=location.host,p=location.pathname,url=r.split("/"),e.enabled()?(url.splice(url.length-1,0,"thresholded",m,a,b,c),location.href="http://"+h+p+"#"+m+"="+a+"&"+b+"&"+c):location.href="http://"+h+p+"#",o.source.tilesUrl=url.join("/"),o.drawer.reset(),o.drawer.update()}dt=function(){now=(new Date).getTime(),console.log(now-then),then=now};var n={id:"view",zoomInButton:"zoom-in",zoomOutButton:"zoom-out",nextButton:"next",previousButton:"previous",tileSources:tileSourcesArray,preserveViewport:!0,prefixUrl:imagePrefixURL,showNavigator:!0,showHomeControl:!1,showFullPageControl:!1,showReferenceStrip:!0,referenceStripSizeRatio:.05,showRotationControl:!0,animationTime:.5,blendTime:.1,constrainDuringPan:!0,maxZoomPixelRatio:1,minZoomLevel:2,visibilityRatio:1,zoomPerScroll:2,timeout:12e4,debugMode:!1,debugGridColor:"#000000"},r="",i="RGB",s,o,u,f,l;$(function(e){function n(e){}o=new OpenSeadragon,u=o.activateImagingHelper(),o.addHandler("open",function(){r=o.source.tilesUrl,$("#name .filename")[0].innerHTML=r,$(o.element).find(".navigator").css("background-color","transparent")}),$("#name").position({my:"center top ",at:"center top ",of:$(".openseadragon-container")}),$("#currentFile").on("click",function(){var e=$(".openseadragon-canvas canvas")[0],t=e.toDataURL("image/png"),n=window.open().document;n.write(""),n.close(),n.body.appendChild(document.createElement("img")).src=t}),dialog=$("#change-input").dialog({position:{my:"left middle",at:"left middle"},minWidth:330}).addClass("no-close"),dialog.find("input").attr("size",2),dialog.find("form").submit(function(e){e.preventDefault()}),$("#matrix").on("change",function(){}),titlebar=$(".ui-dialog-titlebar"),titlebar[0].lastElementChild.remove(),titlebar.append($("#conButtons")[0].children),$("#conButtons").remove(),dialogState="visible",dialogMinHeight="20px",dialogMaxHeight="120px",dialogClickEnabled=!0,$(".ui-dialog-titlebar .ui-icon").on("click",function(){dialogClickEnabled=!1,setTimeout(function(){dialogClickEnabled=!0},100)}),titlebar.parent().draggable({stop:function(){dialogClickEnabled=!1,setTimeout(function(){dialogClickEnabled=!0},100)}}),titlebar.on("click",function(){dialogClickEnabled&&(dialog=$(this).parent(),dialogState=="hidden"?(dialog.animate({height:dialogMaxHeight},100),dialogState="visible"):(dialogMaxHeight=dialog.css("height"),dialog.animate({height:dialogMinHeight},100),dialogState="hidden"))});var t=o.activateImagingHelper({onImageViewChanged:n});ko.applyBindings(v),$("#change-input").disableSelection()}),addOverlay=function(e,t,n){var r=1,i=typeof o._svgOverlayInfo=="undefined"?o.svgOverlay():o.svgOverlay,s=u.vectorToVector(e,t,"d","l"),n=u.vectorToDistance(n,0,"d","l"),r=u.vectorToDistance(r,0,"d","l");d3.select(i).append("rect").style("opacity",.3).style("fill","#f00").attr("x",s.x).attr("width",n).attr("y",s.y).attr("height",n)}}),requirejs.config({baseUrl:"lib",paths:{app:"../app"}}),requirejs(["app/main"]),define("app",function(){});